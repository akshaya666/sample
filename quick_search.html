<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick Search</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='quick_search.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<div class="container">
  <a href="{{ url_for('home') }}" class="menu-link">
    <i class="fas fa-arrow-left"></i> Main Menu
  </a>
  <h1>Quick Search</h1>
  <div class="chat-container">
    <div class="chat-box" id="chat-box">
      <!-- Chat messages will be appended here -->
    </div>
    <select id="document-select">
      <option value="doc1">Document 1</option>
      <option value="doc2">Document 2</option>
      <option value="doc3">Document 3</option>
    </select>
    <div class="input-container">
      <input type="text" id="user-input" placeholder="Ask a question...">
      <button id="send-button" disabled>Send</button>
    </div>
    <div class="feedback-container">
      <i class="fas fa-thumbs-up" id="thumbs-up"></i>
      <i class="fas fa-thumbs-down" id="thumbs-down"></i>
    </div>
  </div>
</div>
<script>
  const userInput = document.getElementById('user-input');
  const sendButton = document.getElementById('send-button');
  const chatBox = document.getElementById('chat-box');
  const thumbsUp = document.getElementById('thumbs-up');
  const thumbsDown = document.getElementById('thumbs-down');
  let lastUserMessage = '';

  userInput.addEventListener('input', () => {
    sendButton.disabled = !userInput.value.trim();
  });

  sendButton.addEventListener('click', () => {
    const message = userInput.value.trim();
    if (message) {
      appendMessage('user', message);
      lastUserMessage = message;
      userInput.value = '';
      sendButton.disabled = true;
      fetchBotResponse(message);
    }
  });

  thumbsUp.addEventListener('click', () => {
    appendMessage('bot', 'Happy to help');
  });

  thumbsDown.addEventListener('click', () => {
    appendMessage('bot', 'Looks like you are not happy with the response');
    fetchBotResponse(lastUserMessage);
  });

  function appendMessage(sender, message) {
    const messageElem = document.createElement('div');
    messageElem.className = `message ${sender}`;
    messageElem.textContent = message;
    if (sender === 'bot') {
      const copyIcon = document.createElement('i');
      copyIcon.className = 'fas fa-copy';
      copyIcon.onclick = () => {
        navigator.clipboard.writeText(message);
      };
      messageElem.appendChild(copyIcon);
    }
    chatBox.appendChild(messageElem);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function fetchBotResponse(message) {
    appendMessage('bot', '...');
    fetch('/api/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ message })
    })
    .then(response => response.json())
    .then(data => {
      const lastBotMessage = document.querySelector('.message.bot:last-child');
      if (lastBotMessage && lastBotMessage.textContent === '...') {
        lastBotMessage.remove();
      }
      appendMessage('bot', data.message);
    })
    .catch(error => {
      console.error('Error:', error);
    });
  }
</script>
</body>
</html>
